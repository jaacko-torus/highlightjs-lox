{"version":3,"file":"lox.min.js","sources":["../../src/lox.ts"],"sourcesContent":["/**\n * @name Lox\n * @param {LanguageFn} hljs\n * @website http://craftinginterpreters.com/\n * @license MIT\n */\n\nimport type { HLJSRegex } from \"../types\"\nimport type { HLJSApi, Language, LanguageFn, Mode } from \"highlight.js\"\nimport hljs from \"highlight.js\"\n\nconst regex = (hljs as HLJSApi & HLJSRegex).regex\n\nconst IDENT_RE = \"[A-Za-z][0-9A-Za-z]*\"\n\nconst LANGUAGE_KEYWORDS = [\n\t\"class\",\n\t\"else\",\n\t\"for\",\n\t\"function\",\n\t\"if\",\n\t\"print\",\n\t\"return\",\n\t\"var\",\n\t\"while\",\n]\n\nconst LITERALS = [\n\t\"false\",\n\t\"nil\",\n\t\"true\",\n]\n\nconst BUILT_IN_VARIABLES = [\n\t\"super\",\n\t\"this\",\n]\n\nconst KEYWORDS = {\n\t$pattern: IDENT_RE,\n\tkeyword: LANGUAGE_KEYWORDS,\n\tliteral: LITERALS,\n\t\"variable.language\": BUILT_IN_VARIABLES\n};\n\nconst NUMBER: Mode = {\n\tscope: \"number\",\n\tvariants: [\n\t\t{ begin: \"[\\\\d]+\" },\n\t\t{ begin: \"\\\\d+(\\.\\\\d+)?\" },\n\t],\n\trelevance: 0\n};\n\nconst PARAMS_CONTAINS = [\n\thljs.C_LINE_COMMENT_MODE,\n\t// eat recursive parens in sub expressions\n\t{\n\t\tbegin: /\\(/,\n\t\tend: /\\)/,\n\t\tkeywords: KEYWORDS,\n\t\tcontains: [\"self\", hljs.C_LINE_COMMENT_MODE]\n\t} as Mode\n];\n\nconst PARAMS: Mode = {\n\tscope: \"params\",\n\tbegin: /\\(/,\n\tend: /\\)/,\n\texcludeBegin: true,\n\texcludeEnd: true,\n\tkeywords: KEYWORDS,\n\tcontains: PARAMS_CONTAINS\n};\n\nconst CLASS_OR_EXTENDS: Mode = {\n\tvariants: [\n\t\t// class Car < Vehicle\n\t\t{\n\t\t\tmatch: [\n\t\t\t\t/class/,\n\t\t\t\t/\\s+/,\n\t\t\t\tIDENT_RE,\n\t\t\t\t/\\s+/,\n\t\t\t\t/</,\n\t\t\t\t/\\s+/,\n\t\t\t],\n\t\t\tscope: {\n\t\t\t\t1: \"keyword\",\n\t\t\t\t3: \"title.class\",\n\t\t\t\t5: \"keyword\",\n\t\t\t\t7: \"title.class.inherited\"\n\t\t\t}\n\t\t},\n\t\t// class Car\n\t\t{\n\t\t\tmatch: [\n\t\t\t\t/class/,\n\t\t\t\t/\\s+/,\n\t\t\t\tIDENT_RE\n\t\t\t],\n\t\t\tscope: {\n\t\t\t\t1: \"keyword\",\n\t\t\t\t3: \"title.class\"\n\t\t\t}\n\t\t},\n\t]\n};\n\nconst FUNCTION_DEFINITION: Mode = {\n\tvariants: [\n\t\t{\n\t\t\tmatch: [\n\t\t\t\t/function/,\n\t\t\t\t/\\s+/,\n\t\t\t\tIDENT_RE,\n\t\t\t\t/(?=\\s*\\()/\n\t\t\t]\n\t\t},\n\t],\n\tscope: {\n\t\t1: \"keyword\",\n\t\t3: \"title.function\"\n\t},\n\tlabel: \"func.def\",\n\tcontains: [PARAMS],\n\tillegal: /%/\n};\n\nconst UPPER_CASE_CONSTANT: Mode = {\n\trelevance: 0,\n\tmatch: /\\b[A-Z][A-Z0-9]+\\b/,\n\tscope: \"variable.constant\"\n};\n\nfunction noneOf(list: string[]) {\n\treturn regex.concat(\"(?!\", list.join(\"|\"), \")\");\n}\n\nconst FUNCTION_CALL: Mode = {\n\tmatch: regex.concat(\n\t\t/\\b/,\n\t\tnoneOf([\"super\"]),\n\t\tIDENT_RE, regex.lookahead(/\\(/)),\n\tscope: \"title.function\",\n\trelevance: 0\n};\n\nconst PROPERTY_ACCESS: Mode = {\n\tbegin: regex.concat(/\\./, regex.lookahead(\n\t\tregex.concat(IDENT_RE, /(?![0-9A-Za-z(])/)\n\t)),\n\tend: IDENT_RE,\n\texcludeBegin: true,\n\tscope: \"property\",\n\trelevance: 0\n};\n\n/**\n * @name Lox\n * @param {HLJSApi} hljs\n * @website http://craftinginterpreters.com/\n */\nfunction lox(hljs: HLJSApi) {\n\treturn {\n\t\tname: \"Lox\",\n\t\taliases: [\"lox\"],\n\t\tkeywords: KEYWORDS,\n\t\tillegal: /#(?![$_A-z])/,\n\t\tcontains: [\n\t\t\thljs.QUOTE_STRING_MODE,\n\t\t\thljs.C_LINE_COMMENT_MODE,\n\t\t\tNUMBER,\n\t\t\t{ // \"value\" container\n\t\t\t\tbegin: \"(\" + hljs.RE_STARTERS_RE + \"|\\\\b(return)\\\\b)\\\\s*\",\n\t\t\t\tkeywords: \"return\",\n\t\t\t\trelevance: 0,\n\t\t\t\tcontains: [\n\t\t\t\t\thljs.C_LINE_COMMENT_MODE,\n\t\t\t\t\thljs.REGEXP_MODE,\n\t\t\t\t\t{ // could be a comma delimited list of params to a function call\n\t\t\t\t\t\tbegin: /,/,\n\t\t\t\t\t\trelevance: 0\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tmatch: /\\s+/,\n\t\t\t\t\t\trelevance: 0\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\tFUNCTION_DEFINITION,\n\t\t\t{\n\t\t\t\t// prevent this from getting swallowed up by function since they appear \"function like\"\n\t\t\t\tbeginKeywords: \"while if for\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t// we have to count the parens to make sure we actually have the correct\n\t\t\t\t// bounding ( ).  There could be any number of sub-expressions inside\n\t\t\t\t// also surrounded by parens.\n\t\t\t\tbegin: \"\\\\b(?!function)\" + hljs.UNDERSCORE_IDENT_RE +\n\t\t\t\t\t\"\\\\(\" + // first parens\n\t\t\t\t\t\"[^()]*(\\\\(\" +\n\t\t\t\t\t\"[^()]*(\\\\(\" +\n\t\t\t\t\t\"[^()]*\" +\n\t\t\t\t\t\"\\\\)[^()]*)*\" +\n\t\t\t\t\t\"\\\\)[^()]*)*\" +\n\t\t\t\t\t\"\\\\)\\\\s*\\\\{\", // end parens\n\t\t\t\treturnBegin: true,\n\t\t\t\tlabel: \"func.def\",\n\t\t\t\tcontains: [\n\t\t\t\t\tPARAMS,\n\t\t\t\t\thljs.inherit(hljs.TITLE_MODE, { begin: IDENT_RE, scope: \"title.function\" })\n\t\t\t\t]\n\t\t\t},\n\t\t\tPROPERTY_ACCESS,\n\t\t\t{\n\t\t\t\tmatch: [/\\binit(?=\\s*\\()/],\n\t\t\t\tscope: { 1: \"title.function\" },\n\t\t\t\tcontains: [PARAMS]\n\t\t\t},\n\t\t\tFUNCTION_CALL,\n\t\t\tUPPER_CASE_CONSTANT,\n\t\t\tCLASS_OR_EXTENDS,\n\t\t\t{\n\t\t\t\tmatch: /\\$[(.]/ // relevance booster for a pattern common to JS libs: `$(something)` and `$.something`\n\t\t\t}\n\t\t]\n\t} as Language;\n}\n\nexport default lox as LanguageFn;"],"names":["regex","hljs","IDENT_RE","KEYWORDS","$pattern","keyword","literal","NUMBER","scope","variants","begin","relevance","PARAMS_CONTAINS","C_LINE_COMMENT_MODE","end","keywords","contains","PARAMS","excludeBegin","excludeEnd","CLASS_OR_EXTENDS","match","FUNCTION_DEFINITION","label","illegal","UPPER_CASE_CONSTANT","FUNCTION_CALL","concat","list","join","lookahead","PROPERTY_ACCESS","name","aliases","QUOTE_STRING_MODE","RE_STARTERS_RE","REGEXP_MODE","beginKeywords","UNDERSCORE_IDENT_RE","returnBegin","inherit","TITLE_MODE"],"mappings":";;;;;;OAWA,MAAMA,EAASC,UAA6BD,MAEtCE,EAAW,uBAyBXC,EAAW,CAChBC,SAAUF,EACVG,QAzByB,CACzB,QACA,OACA,MACA,WACA,KACA,QACA,SACA,MACA,SAiBAC,QAdgB,CAChB,QACA,MACA,QAYA,oBAT0B,CAC1B,QACA,SAUKC,EAAe,CACpBC,MAAO,SACPC,SAAU,CACT,CAAEC,MAAO,UACT,CAAEA,MAAO,iBAEVC,UAAW,GAGNC,EAAkB,CACvBX,UAAKY,oBAEL,CACCH,MAAO,KACPI,IAAK,KACLC,SAAUZ,EACVa,SAAU,CAAC,OAAQf,UAAKY,uBAIpBI,EAAe,CACpBT,MAAO,SACPE,MAAO,KACPI,IAAK,KACLI,cAAc,EACdC,YAAY,EACZJ,SAAUZ,EACVa,SAAUJ,GAGLQ,EAAyB,CAC9BX,SAAU,CAET,CACCY,MAAO,CACN,QACA,MACAnB,EACA,MACA,IACA,OAEDM,MAAO,CACN,EAAG,UACH,EAAG,cACH,EAAG,UACH,EAAG,0BAIL,CACCa,MAAO,CACN,QACA,MACAnB,GAEDM,MAAO,CACN,EAAG,UACH,EAAG,kBAMDc,EAA4B,CACjCb,SAAU,CACT,CACCY,MAAO,CACN,WACA,MACAnB,EACA,eAIHM,MAAO,CACN,EAAG,UACH,EAAG,kBAEJe,MAAO,WACPP,SAAU,CAACC,GACXO,QAAS,KAGJC,EAA4B,CACjCd,UAAW,EACXU,MAAO,qBACPb,MAAO,qBAOR,MAAMkB,EAAsB,CAC3BL,MAAOrB,EAAM2B,OACZ,MANcC,EAOP,CAAC,SANF5B,EAAM2B,OAAO,MAAOC,EAAKC,KAAK,KAAM,MAO1C3B,EAAUF,EAAM8B,UAAU,OAC3BtB,MAAO,iBACPG,UAAW,GAVZ,IAAgBiB,EAahB,MAAMG,EAAwB,CAC7BrB,MAAOV,EAAM2B,OAAO,KAAM3B,EAAM8B,UAC/B9B,EAAM2B,OAAOzB,EAAU,sBAExBY,IAAKZ,EACLgB,cAAc,EACdV,MAAO,WACPG,UAAW,UAQZ,SAAaV,GACZ,MAAO,CACN+B,KAAM,MACNC,QAAS,CAAC,OACVlB,SAAUZ,EACVqB,QAAS,eACTR,SAAU,CACTf,EAAKiC,kBACLjC,EAAKY,oBACLN,EACA,CACCG,MAAO,IAAMT,EAAKkC,eAAiB,uBACnCpB,SAAU,SACVJ,UAAW,EACXK,SAAU,CACTf,EAAKY,oBACLZ,EAAKmC,YACL,CACC1B,MAAO,IACPC,UAAW,GAEZ,CACCU,MAAO,MACPV,UAAW,KAIdW,EACA,CAECe,cAAe,gBAEhB,CAIC3B,MAAO,kBAAoBT,EAAKqC,oBAAzB,gEAQPC,aAAa,EACbhB,MAAO,WACPP,SAAU,CACTC,EACAhB,EAAKuC,QAAQvC,EAAKwC,WAAY,CAAE/B,MAAOR,EAAUM,MAAO,qBAG1DuB,EACA,CACCV,MAAO,CAAC,mBACRb,MAAO,CAAE,EAAG,kBACZQ,SAAU,CAACC,IAEZS,EACAD,EACAL,EACA,CACCC,MAAO"}